#:kivy 2.2.0
#:import math math
#:import MirrorViewWidget mirror_view_widget.MirrorViewWidget
#:import TecWidget mirror_view_widget.TecWidget

<TecWidget>:
    spot_diameter:18
    mirror_px_dia: self.mirror_circle_prop.diameter if self.mirror_circle_prop!= None else 200
    rho_norm: self.rho_phys/TecWidget.rho_max/2 if type(TecWidget.rho_max) == float else 0.5
    x_loc: self.mirror_px_dia*self.rho_norm*math.cos(self.theta)
    y_loc: self.mirror_px_dia*self.rho_norm*math.sin(self.theta)
    x_loc_abs: (self.center_x - self.spot_diameter/2) + self.x_loc
    y_loc_abs: (self.center_y - self.spot_diameter/2) + self.y_loc

    canvas.before:
        Color:
            rgb: self.spot_rgb
        Ellipse:
            size: self.spot_diameter, self.spot_diameter
            # pos: (self.center_x - self.diameter/2) + self.x_loc, (self.center_y - self.diameter/2) + self.y_loc
            pos: self.x_loc_abs, self.y_loc_abs
    size_hint: None,None

    Button:
        background_color: 0,0,0,0
        color: 0,0,0,1
        font_size: 14
        size_hint: None, None
        size: 30,30
        text: ''+str(self.parent.id_no)
        bold: True
        # pos: self.parent.x_loc_abs+self.texture_size[0]/2, self.parent.y_loc_abs+self.texture_size[1]/2
        pos: self.parent.x_loc_abs-5, self.parent.y_loc_abs-5
        on_release: TecWidget.printTecNo(self.parent)
        # disabled: False

<MirrorViewWidget>:
    # border_color: 1,0,0,1
    anchor_x: 'center'
    anchor_y: 'center'
    # Widget:
    # pos: self.parent.pos
    rho_scale: 1
    MirrorCircleWidget:
        id: mirror_circle
        diameter: self.parent.diameter
        # dia: 400
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Ellipse:
                size: self.diameter, self.diameter
                pos: self.center_x - self.diameter/2, self.center_y - self.diameter/2
        size_hint: None,None

<MirrorViewControlPanel>:
    cols: 2
    opts_disabled: True if root.activeTec == None else False
    MirrorViewWidget:
        diameter: self.height*0.9
    GridLayout:
        cols: 2
        size_hint_x: None
        width:600
        BorderGridLayout:
            border_color: 1,1,1,1
            cols: 1
            Label:
                size_hint_y: None
                height: 40
                text: 'Zernike Parameters'
        BorderGridLayout:
            border_color: 1,1,1,1
            cols: 1
            Button:
                size_hint_y: None
                height: 40
                text: 'Load Mirror Config'
                on_release: MirrorViewWidget.readCsv()
            BorderGridLayout:
                border_color: 1,1,1,1
                border_width: 1
                cols: 1
                Label: 
                    text: (root.activeTec.id if root.activeTec != None else 'TEC#') + ' Config Options'
                    halign: 'center'
                    size_hint_y: None
                    height: 40
                BorderGridLayout:
                    cols: 1
                    BorderedLabeledFloatInput:
                        size_hint_y: None
                        height: 40
                        label_text: 'Some value:'  
                        disabled: root.opts_disabled
                    BorderedLabeledFloatInput:
                        size_hint_y: None
                        height: 40
                        label_text: 'Some other value:'
                        disabled: root.opts_disabled
                    Button:
                        size_hint_y: None
                        height: 40
                        text: 'A button'
                        disabled: root.opts_disabled
                    Button:
                        size_hint_y: None
                        height: 40
                        text: 'Another Button'
                        disabled: root.opts_disabled
                    GridLayout:
                        cols: 2
                        Label:
                            size_hint_y: None
                            height: 40
                            text:'Enabled: '
                            disabled: root.opts_disabled
                        CheckBox:
                            size_hint_y: None
                            height: 40
                            disabled: root.opts_disabled